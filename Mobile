
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	//Вставить содержимое обработчика
	//Сообщить("1");
	
КонецПроцедуры

&НаКлиенте
Процедура Войти(Команда)
	// Вставить содержимое обработчика.
	Если ТекКод = КодСМС Тогда
		Сообщить("Код верный");
		АвторизацияПройдена=Истина;
		Элементы.Группа3.Видимость=Ложь;
		ПолучитьДанныеСотрудника();
		Элементы.Группа4.Видимость=Истина;
	Иначе
		ПоказатьПредупреждение(,"Код СМС не верный",5);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПолучитьКод(Команда)
	// Вставить содержимое обработчика.
	Результат = ЗапроситьКодСМС();
	Если ТипЗнч(Результат)=Тип("Число") Тогда
		ТекКод = Результат;
	иначе
		Сообщить(Результат);
	КонецЕсли;
	
КонецПроцедуры
&НаСервере
Функция ЗапроситьКодСМС()
	ТекстОшибки = "";
	ТекОтвет = ОбщийМодуль.ЗапросВебСервиса("SendSMS", ТабельныйНомер, ТекстОшибки);
	Если ТекстОшибки<>"" Тогда
		Возврат ТекстОшибки;
	Иначе
		Возврат ТекОтвет;
	КонецЕсли;
КонецФункции

&НаСервере
Процедура ПолучитьДанныеСотрудника()
	ТекстОшибки = "";
	ТекОтвет = ОбщийМодуль.ЗапросВебСервиса("GetData", ТабельныйНомер, ТекстОшибки);
	Если ТекстОшибки<>"" Тогда
		Сообщить(ТекстОшибки);
	Иначе
		ГлавСтруктура = ТекОтвет.Получить(); //ВЫНИМАЕМ ИЗ ХРАНИЛИЩА
		Если ТипЗнч(ГлавСтруктура)=Тип("Структура") Тогда
			ФИО = ГлавСтруктура.ФИО;
			ДатаРождения = ГлавСтруктура.ДатаРождения;
			МобильныйТелефон = ГлавСтруктура.Представление;
			Пол = ГлавСтруктура.Пол;
			АдресМестаПроживания = ГлавСтруктура.АдресМестаПроживания;
			ДокументУдостоверяющийЛичность = ГлавСтруктура.ДокументУдостоверяющийЛичность;
			ИНН = ГлавСтруктура.ИНН;
			СНИЛС = ГлавСтруктура.СтраховойНомерПФР;
			СоставСемьи = ГлавСтруктура.СоставСемьи;
			СостояниеВБраке = ГлавСтруктура.СостояниеВБраке;
			ФизическоеЛицоОбразованиеТекст = ГлавСтруктура.ФизическоеЛицоОбразованиеТекст;
			
			Если ГлавСтруктура.Свойство("РасчетныйЛисток") Тогда
				РасчетныйЛист = ГлавСтруктура.РасчетныйЛисток;
			КонецЕсли;
			Если ГлавСтруктура.Свойство("ОстатокОтпуска") Тогда
				ОстаткиОтпуска = ГлавСтруктура.ОстатокОтпуска;
			КонецЕсли;
			Если ГлавСтруктура.Свойство("Льготы") Тогда
				ВыбранныеЛьготы.Загрузить(ГлавСтруктура.Льготы);
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры


