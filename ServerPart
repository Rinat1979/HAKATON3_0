
Функция НайтиСотрудникаТелефон(ТабНомер)
	УстановитьПривилегированныйРежим(Истина);
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Сотрудники.Ссылка КАК Ссылка,
	|	Сотрудники.ФизическоеЛицо КАК ФизическоеЛицо
	|ПОМЕСТИТЬ ВремТЗ
	|ИЗ
	|	Справочник.Сотрудники КАК Сотрудники
	|ГДЕ
	|	Сотрудники.Код ПОДОБНО &Код
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ФизическиеЛицаКонтактнаяИнформация.Ссылка КАК Ссылка,
	|	ФизическиеЛицаКонтактнаяИнформация.НомерТелефона КАК НомерТелефона,
	|	ФизическиеЛицаКонтактнаяИнформация.Представление КАК Представление
	|ПОМЕСТИТЬ ВремТЗ2
	|ИЗ
	|	Справочник.ФизическиеЛица.КонтактнаяИнформация КАК ФизическиеЛицаКонтактнаяИнформация
	|ГДЕ
	|	ФизическиеЛицаКонтактнаяИнформация.Тип = &Тип
	|	И ФизическиеЛицаКонтактнаяИнформация.Вид = &Вид
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВремТЗ.Ссылка КАК Ссылка,
	|	ВремТЗ2.НомерТелефона КАК НомерТелефона,
	|	ВремТЗ2.Представление КАК Представление,
	|	ВремТЗ.ФизическоеЛицо.Наименование КАК Наименование,
	|	ВремТЗ.ФизическоеЛицо.ДатаРождения КАК ДатаРождения,
	|	ВремТЗ.ФизическоеЛицо.Пол КАК Пол,
	|	ВремТЗ.ФизическоеЛицо.ИНН КАК ИНН,
	|	ВремТЗ.ФизическоеЛицо.СтраховойНомерПФР КАК СтраховойНомерПФР,
	|	ВремТЗ.ФизическоеЛицо.ФИО КАК ФИО,
	|	ВремТЗ.ФизическоеЛицо.Фамилия КАК Фамилия,
	|	ВремТЗ.ФизическоеЛицо.Имя КАК Имя,
	|	ВремТЗ.ФизическоеЛицо.Отчество КАК Отчество,
	|	ВремТЗ.ФизическоеЛицо КАК ФизическоеЛицо
	|ИЗ
	|	ВремТЗ КАК ВремТЗ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВремТЗ2 КАК ВремТЗ2
	|		ПО ВремТЗ.ФизическоеЛицо = ВремТЗ2.Ссылка";
	Запрос.УстановитьПараметр("Код","%"+СокрЛП(ТабНомер)+"%");
	Запрос.УстановитьПараметр("Тип",Перечисления.ТипыКонтактнойИнформации.Телефон);
	Запрос.УстановитьПараметр("Вид",Справочники.ВидыКонтактнойИнформации.ТелефонМобильныйФизическиеЛица);
	
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТекСтруктура = Новый Структура;
		ТекСтруктура.Вставить("Ссылка",Выборка.ссылка);
		ТекСтруктура.Вставить("НомерТелефона",Выборка.НомерТелефона);
		ТекСтруктура.Вставить("Представление",Выборка.Представление);
		ТекСтруктура.Вставить("Наименование",Выборка.Наименование);
		ТекСтруктура.Вставить("ДатаРождения",Выборка.ДатаРождения);
		ТекСтруктура.Вставить("Пол",Выборка.Пол);
		ТекСтруктура.Вставить("ИНН",Выборка.ИНН);
		ТекСтруктура.Вставить("СтраховойНомерПФР",Выборка.СтраховойНомерПФР);
		ТекСтруктура.Вставить("ФИО",Выборка.ФИО);
		ТекСтруктура.Вставить("Фамилия",Выборка.Фамилия);
		ТекСтруктура.Вставить("Имя",Выборка.Имя);
		ТекСтруктура.Вставить("Отчество",Выборка.Отчество);
		ТекСтруктура.Вставить("РасчетныйЛисток",СформироватьФормуРасчетногоЛистка(Выборка.ФизическоеЛицо,ДобавитьМесяц(ТекущаяДата(),-1)));
		ТекСтруктура.Вставить("ОстатокОтпуска",СформироватьСправкуПоОтпускамСотрудника(Выборка.ФизическоеЛицо));
		
		
		ПоляДанных = 
		"ПолученныеОбразования,
		|СостояниеВБраке,
		|АдресМестаПроживанияПредставление,
		|ТелефонМобильныйПредставление,
		|ДокументПредставление,
		|СоставСемьи";
		
		КадровыеДанные = КадровыйУчет.КадровыеДанныеФизическихЛиц(Ложь, Выборка.ФизическоеЛицо, ПоляДанных);
		
		//ЗаполнитьОбразование(КадровыеДанные);
		ФизическоеЛицоОбразованиеТекст = "<" + НСтр("ru = 'не указано'") + ">";
		Если КадровыеДанные.Количество() > 0 Тогда
			ФизическоеЛицоОбразованиеТекст = КадровыеДанные[0].ПолученныеОбразования;
		КонецЕсли;
		ТекСтруктура.Вставить("ФизическоеЛицоОбразованиеТекст",ФизическоеЛицоОбразованиеТекст);
		
		//ЗаполнитьПаспорт(КадровыеДанные);
		ДокументУдостоверяющийЛичность = "<" + НСтр("ru = 'не указано'") + ">";
		Если КадровыеДанные.Количество() > 0 Тогда
			ДокументУдостоверяющийЛичность = КадровыеДанные[0].ДокументПредставление;
		КонецЕсли;
		ТекСтруктура.Вставить("ДокументУдостоверяющийЛичность",ДокументУдостоверяющийЛичность);

		//ЗаполнитьСостояниеВБраке(КадровыеДанные); 
		СостояниеВБраке = "";
		Если КадровыеДанные.Количество() > 0 Тогда
			СостояниеВБраке = Строка(КадровыеДанные[0].СостояниеВБраке);
		КонецЕсли;
		ТекСтруктура.Вставить("СостояниеВБраке",СостояниеВБраке);

		//ЗаполнитьКонтакты(КадровыеДанные);
		АдресМестаПроживания = "<" + НСтр("ru = 'не указано'") + ">";
		
		Если КадровыеДанные.Количество() > 0 Тогда
			АдресМестаПроживания = КадровыеДанные[0].АдресМестаПроживанияПредставление;
		КонецЕсли;
		ТекСтруктура.Вставить("АдресМестаПроживания",АдресМестаПроживания);
		
		//ЗаполнитьСоставСемьи();
		ПредставлениеСоставаСемьи = Справочники.РодственникиФизическихЛиц.ПредставлениеСоставаСемьи(Выборка.ФизическоеЛицо);
		
		Если ПустаяСтрока(ПредставлениеСоставаСемьи) Тогда
			СоставСемьи = "<" + НСтр("ru = 'не указано'") + ">";
		Иначе
			СоставСемьи = ПредставлениеСоставаСемьи;
		КонецЕсли;
		ТекСтруктура.Вставить("СоставСемьи",СоставСемьи);
		
		
		//Если ЗначениеЗаполнено(ФизическоеЛицо) Тогда 
		//	АдресФотографии = КадровыйУчетРасширенный.АдресФотографииФизическогоЛица(ФизическоеЛицо);		
		//КонецЕсли;
		
		ПрочитатьДанныеЛьгот();

		
		
		
		Возврат ТекСтруктура;
	Иначе 
		Возврат Неопределено;
	КонецЕсли;
	УстановитьПривилегированныйРежим(Ложь);
	
		
	
КонецФункции
//Получаем табельный номер, ищем его в сотрудниках
//Если есть сотрудник то смотрим есть ли у него телефон
//Отправляем на него СМС
//Отправляем в приложение код переданный в СМС для сверки

Функция SendSMS(TabNamber, Message)
	Если ЗначениеЗаполнено(TabNamber) Тогда
		ТекДанныеСотрудинка = НайтиСотрудникаТелефон(TabNamber);
		Если ТекДанныеСотрудинка<>Неопределено Тогда
			ТекКод = ОтправитьКодКлиенту(ТекДанныеСотрудинка);
			Возврат ТекКод;
		Иначе
			Message = "Сотрудник не найден "+TabNamber;
			Возврат 1;
		КонецЕсли;
	Иначе
		Message = "Табельный номер не заполнен";
		Возврат 1
	КонецЕсли;
КонецФункции
